# EchoMind Flutter 转换 — 总起说明（每个任务开始前必读）

## 项目背景

将 HTML 前端原型转换为 Flutter 应用。HTML 原型有缺陷（硬编码像素、响应式缺失、DOM 拼接），但组件关系与页面结构正确。

**核心原则：Flutter 复刻的唯一真相来源是截图与功能手册，不是 HTML 代码。**

## 项目路径

| 内容 | 路径 |
|------|------|
| Flutter 项目 | `echomind_app/` |
| 页面说明文档 | `docs/第二阶段_html转flutter/18个html页面的分别说明文档/` |
| HTML 截图 | `docs/第一阶段_html细化/html截图验证/` |
| HTML 源码（仅参考） | `html前端——component纯净组件拆解版/` |

## Flutter 项目结构

```
echomind_app/lib/
├── app/
│   ├── app_routes.dart       # 20个路由常量
│   ├── app_router.dart       # GoRouter 配置
│   └── app.dart
├── features/
│   ├── home/                 # ✅ 已完成
│   ├── global_knowledge/     # ✅ 已完成
│   ├── memory/               # ✅ 已完成
│   ├── community/            # ✅ 已完成
│   ├── profile/              # ✅ 已完成
│   ├── <其他15个页面>/        # ⬜ stub 待实现
│   │   ├── <page>_page.dart
│   │   └── widgets/
│   │       └── <component>_widget.dart  (Placeholder)
├── shared/
│   ├── theme/app_theme.dart  # 主题常量
│   └── widgets/
│       ├── page_shell.dart   # Tab页壳（含底部导航）
│       └── main_bottom_nav.dart
└── main.dart
```

## 主题常量（AppTheme）

```dart
// 颜色
primary: #007AFF    background: #F2F2F7    surface: #FFFFFF
textPrimary: #1C1C1E    textSecondary: #8E8E93    divider: #E5E5EA
danger: #FF3B30    success: #34C759    warning: #FF9500

// 间距
spacingXs: 4  spacingSm: 8  spacingMd: 12  spacingLg: 16  spacingXl: 24

// 圆角
radiusSm: 8  radiusMd: 12  radiusLg: 16
```

## 路由常量（AppRoutes）

```dart
home: '/'                    community: '/community'
memory: '/memory'            profile: '/profile'
globalKnowledge: '/global-knowledge'  globalModel: '/global-model'
globalExam: '/global-exam'   aiDiagnosis: '/ai-diagnosis'
flashcardReview: '/flashcard-review'  knowledgeDetail: '/knowledge-detail'
knowledgeLearning: '/knowledge-learning'  modelDetail: '/model-detail'
modelTraining: '/model-training'  predictionCenter: '/prediction-center'
questionAggregate: '/question-aggregate'  questionDetail: '/question-detail'
uploadHistory: '/upload-history'  uploadMenu: '/upload-menu'
weeklyReview: '/weekly-review'  registerStrategy: '/register-strategy'
```

## 编码规范

1. **页面结构**：子页面用 `Scaffold`，不用 `PageShell`（PageShell 仅用于5个Tab页）
2. **导入**：使用 `package:echomind_app/...` 绝对路径
3. **主题**：颜色/间距/圆角一律用 `AppTheme.xxx`，不硬编码
4. **路由跳转**：`context.push(AppRoutes.xxx)` 或 `context.pop()`
5. **组件命名**：文件 `snake_case_widget.dart`，类 `PascalCaseWidget`
6. **私有子组件**：用 `_PrivateWidget` 前缀，放在同一文件内
7. **Mock 数据**：硬编码在 widget 内，用 `const` 列表/Map
8. **文本溢出**：标题 `maxLines: 1, overflow: TextOverflow.ellipsis`；描述 `maxLines: 2`
9. **响应式**：使用 `Expanded`、`Flexible`、百分比宽度，不用固定像素宽度

## 已完成页面参考模式

**Tab 页面模式**（home 为例）：
```dart
PageShell(
  tabIndex: 0,
  body: Column(children: [
    Expanded(child: ListView(children: [TopFrameWidget(), ...])),
    ActionOverlayWidget(),  // 如有底部浮层
  ]),
)
```

**子页面模式**（待实现页面应遵循）：
```dart
Scaffold(
  body: SafeArea(
    child: Column(children: [
      TopFrameWidget(),  // 顶栏含返回按钮
      Expanded(child: ListView(children: [...])),
      // ActionOverlayWidget(),  // 如有底部浮层
    ]),
  ),
)
```

**TopFrame 带返回按钮模式**：
```dart
Padding(
  padding: EdgeInsets.symmetric(horizontal: 16, vertical: 12),
  child: Row(children: [
    GestureDetector(onTap: () => context.pop(), child: Icon(Icons.arrow_back_ios, size: 20)),
    SizedBox(width: 8),
    Text(title, style: TextStyle(fontSize: 20, fontWeight: FontWeight.bold)),
  ]),
)
```

## 每个任务的工作流

1. **读文档**：读取本任务文档中的附录（页面说明 + 截图 + 组件详情），无需再读其他文件
2. **看截图**：查看页面全图和组件截图，理解视觉目标
3. **定位文件**：找到 Flutter 中的 stub 页面和组件文件
4. **参考 HTML**（可选）：查看 HTML 源码获取文案、mock 数据、跳转关系
5. **实现**：逐个组件实现，从 TopFrame 开始，再实现其他组件，最后组装页面
6. **自检**：确保路由跳转正确、主题常量使用正确、文本溢出处理到位
7. **截图留档**：将完成后的页面效果截图保存到 `docs/第二阶段_html转flutter/截图验证/` 目录下，文件名格式为 `<页面名>_完成效果.png`，用于对比验证和留档查看
8. **完成说明**：在 `docs/第二阶段_html转flutter/18个页面的完成说明文档/` 目录下创建对应的完成说明文档（如 `01_index_首页_完成说明.md`），内容包括：实现的组件列表、与截图的差异说明、路由跳转验证结果、已知问题或遗留项
9. **拉起下一任务**：当前任务完成后，自动读取下一个编号的任务提示词文档（如完成 01 后读取 02），开始执行下一个页面的工作流。若当前为最后一个任务（18），则输出"全部18个页面任务已完成"

## 输出目录说明

| 用途 | 路径 |
|------|------|
| 截图留档 | `docs/第二阶段_html转flutter/截图验证/` |
| 完成说明 | `docs/第二阶段_html转flutter/18个页面的完成说明文档/` |
| 任务提示词 | `docs/第二阶段_html转flutter/18个页面的任务分解提示词文档/` |
